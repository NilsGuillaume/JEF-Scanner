<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Tickets kaufen ‚Äì Spring Gala</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />

  <!-- PayPal SDK -->
  <script 
    src="https://www.paypal.com/sdk/js?client-id=BAA6Z2kU6-TesiMjcbBozmJQ2pDPYMmF4VODKR07Gn0n-tQjK8XFlfo_ENTXTOIhGLHluhWN4Br2Z0_ukQ&components=hosted-buttons&disable-funding=venmo&currency=EUR">
  </script>

  <style>
    :root{
      --bg:#0b0f14; --card:#111827; --muted:#9aa4b2; --text:#e6edf3; --line:#1f2937;
      --accent:#60a5fa;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f7fafc; --card:#ffffff; --text:#0b1220; --line:#e5e7eb; --muted:#4b5563; --accent:#2563eb; }
    }
    *{ box-sizing:border-box }
    html,body{ margin:0; padding:0; background:var(--bg); color:var(--text); font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial }
    a{ color:var(--accent); text-decoration:none }
    header{ border-bottom:1px solid var(--line); position:sticky; top:0; backdrop-filter:blur(6px); background:color-mix(in oklab, var(--bg) 85%, transparent) }
    .wrap{ max-width:980px; margin:0 auto; padding:20px }
    .brand{ font-weight:700; letter-spacing:.2px }
    .grid{ display:grid; grid-template-columns:1.1fr .9fr; gap:24px; margin-top:24px }
    @media (max-width: 900px){ .grid{ grid-template-columns:1fr } }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:16px; padding:22px }
    .meta{ display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:12px }
    @media (max-width:700px){ .meta{ grid-template-columns:1fr } }
    .item{ background:color-mix(in oklab, var(--card) 90%, var(--bg)); border:1px dashed var(--line); padding:12px 14px; border-radius:12px }
    .badge{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; font-weight:600; font-size:12px; border:1px solid #10b98155; color:#10b981; background:#10b9811a }
    .price{ font-size:clamp(24px, 3vw, 32px); font-weight:800 }
    .muted{ color:var(--muted) }
    .divider{ height:1px; background:var(--line); margin:16px 0 }
    .panel{ display:flex; flex-direction:column; gap:14px }
    .overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:#000a; z-index:9999; font-size:20px }
    .overlay.show{ display:flex }
    .ticket{ display:none; background:var(--card); border:2px solid var(--accent); border-radius:16px; padding:24px; margin-top:24px; text-align:center; }
    .ticket.show{ display:block; animation: fadeIn 0.5s ease-in; }
    .ticket h2{ color:var(--accent); margin-top:0; }
    .ticket-code{ font-family:monospace; font-size:24px; letter-spacing:4px; background:var(--bg); padding:12px; border-radius:8px; margin:16px 0; border:1px dashed var(--accent); }
    .success-badge{ background:#10b981; color:white; padding:8px 16px; border-radius:20px; font-weight:600; margin-bottom:16px; display:inline-block; }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Test Button Styles */
    .test-mode{ background:#f59e0b; color:white; padding:12px 20px; border:none; border-radius:8px; font-weight:600; cursor:pointer; margin-top:10px; }
    .test-mode:hover{ background:#d97706; }
  </style>
</head>

<body>
  <header>
    <div class="wrap" aria-label="Site header">
      <div class="brand">üéüÔ∏è EventBox</div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" aria-labelledby="title">
      <h1 id="title">Spring Gala ‚Äì General Admission</h1>
      <p>Samstag, 3. Mai 2026 ¬∑ 19:30 ‚Äî Kulturforum, Berlin</p>
    </section>

    <section class="grid" aria-label="Ticket checkout">
      <!-- Eventinfo -->
      <article class="card">
        <div class="badge" aria-label="ticket status">Verf√ºgbar ¬∑ Begrenzte Pl√§tze</div>
        <div class="meta">
          <div class="item">
            <div class="muted">Einlass</div>
            <div><strong>1√ó</strong> Standardticket</div>
          </div>
          <div class="item">
            <div class="muted">Wann &amp; wo</div>
            <div>Sa, 3. Mai 2026 ¬∑ 19:30<br/>Kulturforum, Matth√§ikirchplatz, Berlin</div>
          </div>
        </div>
        <div class="divider"></div>
        <h2 class="price" aria-label="Price">‚Ç¨29.00</h2>
        <p class="muted">inkl. USt. ¬∑ E-Ticket erscheint sofort nach erfolgreicher Zahlung</p>
      </article>

      <!-- Zahlung -->
      <aside class="card panel" aria-label="Zahlung">
        <h2 style="margin:0">Checkout</h2>
        <p class="muted" style="margin-top:-6px">Zahle mit PayPal. Dein Ticket wird anschlie√üend sofort ge√∂ffnet.</p>

        <!-- PayPal Button Container -->
        <div id="paypal-container-SP2E3J2QVPCUJ"></div>

        <!-- Test Button f√ºr lokales Testing -->
        <button class="test-mode" onclick="simulatePayment()">üé≠ Test-Modus: Zahlung simulieren</button>

        <div class="divider"></div>
        <small class="muted">
          Mit dem Fortfahren stimmst du unseren <a href="#" rel="nofollow">AGB</a> und der <a href="#" rel="nofollow">R√ºckerstattungsrichtlinie</a> zu.
        </small>
      </aside>
    </section>

    <!-- Ticket Anzeige (wird nach Zahlung angezeigt) -->
    <section class="ticket" id="ticket">
      <div class="success-badge">‚úÖ Zahlung erfolgreich!</div>
      <h2>üéâ Dein Ticket f√ºr die Spring Gala</h2>
      <p><strong>Spring Gala ‚Äì General Admission</strong></p>
      <p>Samstag, 3. Mai 2026 ¬∑ 19:30<br/>Kulturforum, Matth√§ikirchplatz, Berlin</p>
      
      <div class="ticket-code" id="ticketCode">Lade Ticket...</div>
      
      <p><strong>Name:</strong> <span id="ticketName">Max Mustermann</span></p>
      <p class="muted">Dieses Ticket wird am Einlass gescannt. Bitte zeige es vor oder drucke es aus.</p>
      <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
        <button onclick="window.print()" style="background:var(--accent); color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">üìÑ Ticket drucken</button>
        <button onclick="saveTicket()" style="background:#10b981; color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">üíæ Ticket speichern</button>
      </div>
    </section>
  </main>

  <!-- Lade-Overlay -->
  <div class="overlay" id="overlay" role="status" aria-live="polite">‚è≥ Ticket wird erstellt ‚Ä¶</div>

  <script>
    // Ticket-Generierung
    function generateTicketCode() {
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ0123456789';
      let result = 'SG-';
      for (let i = 0; i < 12; i++) {
        if (i > 0 && i % 4 === 0) result += '-';
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    function showTicket() {
      const ticket = document.getElementById('ticket');
      const ticketCode = document.getElementById('ticketCode');
      const overlay = document.getElementById('overlay');
      
      console.log('Zeige Ticket an...');
      
      // Overlay anzeigen
      overlay.classList.add('show');
      
      // Kurze Verz√∂gerung f√ºr realistischen Effekt
      setTimeout(() => {
        // Ticket Code generieren
        const newTicketCode = generateTicketCode();
        ticketCode.textContent = newTicketCode;
        
        // Timestamp f√ºr Kaufdatum
        const now = new Date();
        document.getElementById('ticketName').textContent = `Kunde (${now.toLocaleDateString('de-DE')})`;
        
        // Overlay ausblenden und Ticket anzeigen
        overlay.classList.remove('show');
        ticket.classList.add('show');
        
        // Zum Ticket scrollen
        ticket.scrollIntoView({ behavior: 'smooth' });
        
        // Erfolg in Konsole loggen
        console.log('Ticket erfolgreich erstellt:', newTicketCode);
      }, 1500);
    }

    // Test-Funktion f√ºr lokales Testing
    function simulatePayment() {
      console.log('Simuliere PayPal-Zahlung...');
      showTicket();
    }

    // Ticket speichern Funktion
    function saveTicket() {
      const ticketCode = document.getElementById('ticketCode').textContent;
      const ticketData = {
        event: "Spring Gala ‚Äì General Admission",
        date: "Samstag, 3. Mai 2026 ¬∑ 19:30",
        location: "Kulturforum, Matth√§ikirchplatz, Berlin",
        code: ticketCode,
        purchased: new Date().toLocaleString('de-DE')
      };
      
      localStorage.setItem('springGalaTicket', JSON.stringify(ticketData));
      alert('‚úÖ Ticket wurde lokal gespeichert!');
    }

    // Beim Laden pr√ºfen ob bereits ein Ticket existiert
    window.addEventListener('load', function() {
      const savedTicket = localStorage.getItem('springGalaTicket');
      if (savedTicket) {
        const ticketData = JSON.parse(savedTicket);
        document.getElementById('ticketCode').textContent = ticketData.code;
        document.getElementById('ticketName').textContent = `Kunde (${new Date(ticketData.purchased).toLocaleDateString('de-DE')})`;
        document.getElementById('ticket').classList.add('show');
        console.log('Gespeichertes Ticket geladen:', ticketData.code);
      }
    });

    // PayPal Integration - Vereinfachte Version
    try {
      paypal.HostedButtons({
        hostedButtonId: "SP2E3J2QVPCUJ",
        onApprove: function (data, actions) {
          console.log('PayPal Zahlung erfolgreich:', data);
          showTicket();
        },
        onError: function (err) {
          console.error('PayPal Fehler:', err);
          alert('Es gab ein Problem mit der Zahlung. Bitte versuche es erneut.');
        },
        onCancel: function (data) {
          console.log('Zahlung abgebrochen vom Benutzer');
        }
      }).render("#paypal-container-SP2E3J2QVPCUJ");
      
      console.log('PayPal Button wurde geladen');
    } catch (error) {
      console.error('Fehler beim Laden des PayPal Buttons:', error);
    }
  </script>
</body>
</html>
